# Road segments for NB
# Website: http://www.snb.ca/geonb1/e/DC/catalogue-E.asp
# License: GeoNB Open Data Licence (http://geonb.snb.ca/documents/license/geonb-odl_en.pdf)

# Common elements
datasetname: &datasetname "New Brunswick"

# Data defintion
data:
  filename: /test_data/geonb_nbrn-rrnb_shp/geonb_nbrn-rrnb_road-route.shp
  layer:
  driver: ESRI Shapefile
  crs: "EPSG:2953"
  spatial: True
conform:
  addrange:
    acqtech:
    metacover:
    credate:
    datasetnam: *datasetname
    accuracy:
    provider:
    revdate:
    specvers:
    l_altnanid:
    r_altnanid:
    l_digdirfg:
    r_digdirfg:
    l_hnumf:
      field: l_hnumf
      functions:
        - function: regex_find
          pattern: "(^\\d+)"
          match_index: 0
          group_index: 0
    r_hnumf:
      field: r_hnumf
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    l_hnumsuff:
      field: l_hnumf
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
          modify_parameters:
            regex_find:
              strip_result: True
    r_hnumsuff:
      field: r_hnumf
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
          modify_parameters:
            regex_find:
              strip_result: True
    l_hnumtypf:
    r_hnumtypf:
    l_hnumstr: l_hnumstr
    r_hnumstr: r_hnumstr
    l_hnuml:
      field: l_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    r_hnuml:
      field: r_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    l_hnumsufl:
      field: l_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
          modify_parameters:
            regex_find:
              strip_result: True
    r_hnumsufl:
      field: r_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
          modify_parameters:
            regex_find:
              strip_result: True
    l_hnumtypl:
    r_hnumtypl:
    nid: uuid
    l_offnanid: uuid
    r_offnanid: uuid
    l_rfsysind:
    r_rfsysind:
  roadseg:
    acqtech:
    metacover:
    credate:
    datasetnam: *datasetname
    accuracy:
    provider:
    revdate:
    specvers:
    l_adddirfg:
    r_adddirfg:
    adrangenid: uuid
    closing: closing
    exitnbr: exitnbr
    l_hnumf:
      field: l_hnumf
      functions:
        - function: regex_find
          pattern: "(^\\d+)"
          match_index: 0
          group_index: 0
    r_hnumf:
      field: r_hnumf
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    # roadclass:
    #   field: roadclass
    #   functions:
    #     - function: regex_sub
    #       pattern_from: "NBDOT|NBDNR|DOT"
    #       pattern_to: ""
    #     - function: regex_sub
    #       pattern_from: "/"
    #       pattern_to: " / "
    roadclass:
      field: roadclass
      functions:
        - function: replace
          args:
            pattern: "NBDOT|NBDNR|DOT"
            replacement: ""
        - function: replace
          args:
            pattern: "/"
            replacement: " / "
    l_hnuml:
      field: l_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    r_hnuml:
      field: r_hnuml
      functions:
        - function: copy_attribute_functions
          attributes: [l_hnumf]
    nid: nid
    nbrlanes: nbrlanes
    l_placenam: l_placenam
    r_placenam: r_placenam
    l_stname_c: streetname
    r_stname_c: streetname
    pavsurf: pavsurf
    pavstatus: pavstatus
    roadjuris:
    roadsegid: roadsegid
    rtename1en: rtename1en
    rtename2en: rtename2en
    rtename3en:
    rtename4en:
    rtename1fr: rtename1fr
    rtename2fr: rtename2fr
    rtename3fr:
    rtename4fr:
    rtnumber1: rtnumber1
    rtnumber2: rtnumber2
    rtnumber3:
    rtnumber4:
    rtnumber5:
    speed: speed
    strunameen: strunameen
    strunamefr: strunamefr
    structid:
    structtype: structtype
    trafficdir: trafficdir
    unpavsurf: unpavsurf
  strplaname:
    acqtech:
    metacover:
    credate:
    datasetnam: *datasetname
    accuracy:
    provider:
    revdate:
    specvers:
    dirprefix:
      field: streetname
      functions:
        - function: extract_domain
          args:
            domain_name: directional_indicator
            pattern: "\\b(domain)\\b(?!$)"
    # dirprefix:
    #   field: streetname
    #   functions:
    #     - function: regex_find
    #       pattern: "\\b(domain)\\b(?!$)"
    #       match_index: 0
    #       group_index: 0
    dirsuffix:
      field: streetname
      functions:
        - function: extract_domain
          args:
            domain_name: directional_indicator
            pattern: "(?<!^)\\b(domain)\\b"
    # dirsuffix:
    #   field: streetname
    #   functions:
    #     - function: copy_attribute_functions
    #       attributes: [dirprefix]
    #       modify_parameters:
    #         regex_find:
    #           strip_result: True
    #     - function: regex_find
    #       pattern: "(?<!^)\\b(domain)\\b"
    #       match_index: -1
    #       group_index: 0
    #       sub_inplace:
    #         pattern_from: "[-]"
    #         pattern_to: " "
    muniquad:
    nid: uuid
    # placename:
    #   field: [l_placenam, r_placenam]
    #   functions:
    #     - function: split_record
    #       field: None
    placename: l_placenam
    placetype:
    province: *datasetname
    starticle:
      field: streetname
      functions:
        - function: extract_domain
          args:
            domain_name: street_name_article
            pattern: "\\b(domain)\\b"
    # starticle:
    #   field: streetname
    #   functions:
    #     - function: regex_find
    #       pattern: "\\b(domain)\\b"
    #       match_index: 0
    #       group_index: 0
    #       sub_inplace:
    #         pattern_from: "[-]"
    #         pattern_to: " "
    namebody:
      field: streetname
      functions:
        - function: copy_attribute_functions
          attributes: [starticle, dirsuffix, strtysuf]
          modify_parameters:
            regex_find:
              strip_result: True
    strtypre:
      field: streetname
      functions:
        - function: extract_domain
          args:
            domain_name: street_type
            pattern: "\\b(domain)\\b(?!$)"
      # field: streetname
      # functions:
      #   - function: regex_find
      #     pattern: "\\b(domain)\\b(?!$)"
      #     match_index: 0
      #     group_index: 0
    strtysuf:
      field: streetname
      functions:
        - function: extract_domain
          args:
            domain_name: street_type
            pattern: "\\b(domain)\\b(?!$)"
      # field: streetname
      # functions:
      #   - function: copy_attribute_functions
      #     attributes: [strtypre]
      #     modify_parameters:
      #       regex_find:
      #         strip_result: True
      #   - function: regex_find
      #     pattern: "(?<!^)\\b(domain)\\b"
      #     match_index: -1
      #     group_index: 0
      #     sub_inplace:
      #       pattern_from: "[-]"
      #       pattern_to: " "